---
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

# mk8dx

<!-- badges: start -->

<!-- badges: end -->

The mk8dx package converts lss files for MK8DX speedruns into usable table data.

## Installation

You can install the development version of mk8dx from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("sj-io/mk8dx")
```

After installing the package, load it to use it.

```{r mk8dx}
library(mk8dx)
```

## Convert lss data to a table format

`mk_lss` is a function that converts .lss file data into a table.

```{r mk_lss}
library(dplyr)

file <- "inst/extdata/bell-cup.lss"

bell_cup <- mk_lss(file)

glimpse(bell_cup)
```

The `mk_lss()` function reads the file as xml data using `xml2`. It then pulls the data with these functions:

-   `mk_variables()`: Gets the category name, number of attempts, and metadata variables, if any exist.
-   `mk_attempts()`: Gets the attempt id, when the run began and ended, and how long the run lasted (will be NA if run was not completed).
-   `mk_segments()`: Gets the segment/track id for the run, track name, and your personal best time for that track.
-   `mk_segment_times()`: Gets the split time for the track.

### Map a folder of lss files

To get data from all lss files in a folder, use the `purrr::map()` function.

```{r map_lss}
library(purrr)

f <- "inst/extdata/"     # folder path
files <- paste0(f, list.files(f, pattern = ".lss"))

all_runs <- map(files, mk_lss) |> list_rbind()

glimpse(all_runs)
```

### Convert split time data

Date-times and run/split times are currently saved as character data. To convert these, use the `lubridate` package.

```{r mk_time}
library(lubridate)

# format dates; convert times to seconds
all_runs_with_periods <- all_runs %>% 
  mutate(
    across(c(attempt_started, attempt_ended), ~ mdy_hms(.x)),
    across(ends_with("_time"), ~ period_to_seconds(hms(.x))),
    .keep = "used"
    ) %>% rename(PB_time = best_segment_time)
# last two lines make table legible in readme

head(all_runs_with_periods)
```

## Credit

This package is based on [Chipdelmal's MK8D package](https://github.com/Chipdelmal/MK8D), which uses python to convert lss files to a dataframe.
